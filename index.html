<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sua Loja Online</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display.swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; background-color: #f8fafc; }
        /* ## CORREÇÃO DE RESPONSIVIDADE ##: A classe 'overflow-hidden' será adicionada via JS para travar o scroll */
        body.overflow-hidden { overflow: hidden; }
        .fade-in { animation: fadeIn 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px;}
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .swiper-container { position: relative; padding: 0 10px; }
        .swiper-button-next, .swiper-button-prev { position: absolute; top: 50%; transform: translateY(-50%); width: 44px; height: 44px; background-color: white; border-radius: 50%; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); display: none; align-items: center; justify-content: center; color: #334155; transition: all 0.2s ease-in-out; }
        @media (min-width: 640px) { .swiper-button-next, .swiper-button-prev { display: flex; } }
        .swiper-button-next:hover, .swiper-button-prev:hover { background-color: #f1f5f9; transform: translateY(-50%) scale(1.1); }
        .swiper-button-next { right: -15px; }
        .swiper-button-prev { left: -15px; }
        .swiper-button-next::after, .swiper-button-prev::after { font-size: 18px; font-weight: bold; }
        .invalid-field { border-color: #ef4444 !important; }
        .invalid-field:focus { outline: none; box-shadow: 0 0 0 2px #ef4444; }
        input[type="date"]:invalid::-webkit-calendar-picker-indicator, input[type="time"]:invalid::-webkit-calendar-picker-indicator { filter: invert(0.5); }
        #bottom-sheet-container.opacity-100 { opacity: 1; }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/90 backdrop-blur-lg shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <img src="logo.png" alt="Logotipo da Loja" class="h-16 sm:h-20">
            <button onclick="toggleCart()" class="relative text-slate-700 hover:text-sky-600 transition-colors">
                <i class="fas fa-shopping-bag fa-lg"></i>
                <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8">
        <section class="my-8 fade-in">
         <img src="banner.jpg" onerror="this.style.display='none'" alt="Banner do negócio" class="w-full h-48 md:h-80 object-cover object-center rounded-2xl shadow-lg">
        </section>
        <section id="produtos" class="fade-in pt-8">
            <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-10 text-slate-900">Nossos Produtos</h1>
            <div id="product-carousels" class="space-y-16"></div>
        </section>
    </main>

    <footer class="bg-slate-800 text-slate-300 mt-20 py-10">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 engsoftwaredelivery. Todos os direitos reservados.</p>
        </div>
    </footer>

    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full sm:max-w-md bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 flex flex-col">
        <div class="p-4 flex justify-between items-center border-b flex-shrink-0">
            <h2 class="text-2xl font-bold text-slate-900">Seu Carrinho</h2>
            <button onclick="toggleCart()" class="text-slate-600 hover:text-slate-900"><i class="fas fa-times fa-lg"></i></button>
        </div>
        <div id="cart-items" class="flex-grow p-4 overflow-y-auto"></div>
        <div id="cart-footer-sticky" class="p-4 border-t bg-slate-50 flex-shrink-0">
            <div class="flex justify-between items-center font-bold text-xl mb-4"><span>Total:</span><span id="cart-total" class="text-sky-600">R$ 0,00</span></div>
            <div class="mb-4">
                <label class="block mb-2 font-medium text-slate-700">Como você gostaria de receber?</label>
                <div class="grid grid-cols-3 gap-2" id="order-options">
                    <div><input type="radio" id="option-delivery" name="order-option" value="Delivery" class="hidden peer" checked onchange="handleOrderOptionChange()"><label for="option-delivery" class="block p-3 border rounded-lg cursor-pointer text-center text-sm peer-checked:bg-sky-600 peer-checked:text-white peer-checked:border-sky-600 transition-colors"><i class="fas fa-motorcycle block mb-1"></i> Delivery</label></div>
                    <div><input type="radio" id="option-pickup" name="order-option" value="Retirada" class="hidden peer" onchange="handleOrderOptionChange()"><label for="option-pickup" class="block p-3 border rounded-lg cursor-pointer text-center text-sm peer-checked:bg-sky-600 peer-checked:text-white peer-checked:border-sky-600 transition-colors"><i class="fas fa-store block mb-1"></i> Retirada</label></div>
                    <div id="agendar-option-container"><input type="radio" id="option-schedule" name="order-option" value="Agendar Mesa" class="hidden peer" onchange="handleOrderOptionChange()"><label for="option-schedule" class="block p-3 border rounded-lg cursor-pointer text-center text-sm peer-checked:bg-sky-600 peer-checked:text-white peer-checked:border-sky-600 transition-colors"><i class="fas fa-calendar-alt block mb-1"></i> Agendar</label></div>
                </div>
            </div>
            <div class="space-y-3 mb-4 max-h-[25vh] overflow-y-auto" id="checkout-form">
                <div id="address-field"><input type="text" id="customer-address" placeholder="Seu endereço para entrega" class="w-full p-3 border rounded-lg"></div>
                <div id="schedule-fields" class="hidden space-y-3">
                     <input type="date" id="schedule-date" class="w-full p-3 border rounded-lg text-gray-500" onchange="this.style.color='black'">
                     <input type="time" id="schedule-time" class="w-full p-3 border rounded-lg text-gray-500" onchange="this.style.color='black'">
                     <input type="number" id="schedule-people" placeholder="Nº de pessoas" min="1" class="w-full p-3 border rounded-lg">
                </div>
                <input type="text" id="customer-name" placeholder="Seu nome completo" class="w-full p-3 border rounded-lg" required>
                <input type="tel" id="customer-contact" placeholder="Seu telefone (WhatsApp)" class="w-full p-3 border rounded-lg" required>
                <div class="relative"><select id="customer-payment" class="w-full p-3 border rounded-lg appearance-none bg-white text-gray-500" required onchange="this.style.color='black'"><option value="" disabled selected>Forma de Pagamento</option><option value="Dinheiro">Dinheiro</option><option value="Cartão de Crédito">Cartão de Crédito</option><option value="Cartão de Débito">Cartão de Débito</option><option value="Pix">Pix</option></select><div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"><i class="fas fa-chevron-down"></i></div></div>
                <textarea id="customer-observation" placeholder="Observação (ponto de referência, etc)" rows="2" class="w-full p-3 border rounded-lg"></textarea>
            </div>
            <button id="finalize-button" onclick="finalizeOrder()" class="w-full bg-green-500 text-white py-3 rounded-lg font-bold text-lg transition-all flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                <i class="fab fa-whatsapp"></i> Finalizar Pedido
            </button>
        </div>
    </div>
    
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4" onclick="closeModal()"><div id="modal-content" class="bg-white rounded-2xl w-full max-w-3xl max-h-[90vh] flex flex-col md:flex-row transform scale-95 transition-transform duration-300 overflow-y-auto" onclick="event.stopPropagation()"></div></div>
    
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-slate-900 text-white py-3 px-6 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 flex items-center gap-3"><i class="fas fa-check-circle text-green-400"></i> Item adicionado ao carrinho!</div>
    
    <div id="bottom-sheet-container" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[60] transition-opacity duration-300 opacity-0" onclick="closeCartConfirmationModal()">
        <div id="bottom-sheet-content" class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl p-6 transform translate-y-full transition-transform duration-300 ease-in-out" onclick="event.stopPropagation()">
            <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-4"></div>
            <div class="text-center">
                <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
                <h2 class="text-2xl font-bold text-slate-900 mb-2">Produto Adicionado!</h2>
                <p class="text-slate-600 mb-6">O que você deseja fazer agora?</p>
                <div class="flex flex-col gap-3">
                    <button onclick="goToCart()" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold hover:bg-sky-700 transition-colors text-lg">Ir para o Carrinho</button>
                    <button onclick="closeCartConfirmationModal()" class="w-full bg-slate-200 text-slate-800 py-3 rounded-lg font-semibold hover:bg-slate-300 transition-colors">Continuar Comprando</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>
    <script>
        let allProducts = []; let cart = []; let lojaConfig = {}; let empresaWhatsappNumber = '5511999999999';
        let primeiroItemAdicionado = false;

        // ## CORREÇÃO DE RESPONSIVIDADE ##: Nova função para travar a rolagem da página
        function toggleBodyScroll(lock) {
            document.body.classList.toggle('overflow-hidden', lock);
        }

        document.addEventListener('DOMContentLoaded', () => { fetchProducts(); loadCart(); document.getElementById('checkout-form').addEventListener('input', validarFormularioCheckout); handleOrderOptionChange(); const today = new Date().toISOString().split('T')[0]; document.getElementById('schedule-date').setAttribute('min', today); });
        async function fetchProducts() { try { const response = await fetch(`produtos.json?v=${new Date().getTime()}`); if (!response.ok) throw new Error(`Arquivo produtos.json não encontrado.`); const data = await response.json(); lojaConfig = data.config || {}; allProducts = data.produtos; empresaWhatsappNumber = lojaConfig.whatsappNumber || empresaWhatsappNumber; applyStoreConfig(); renderCarousels(); syncCartWithProducts(); } catch (error) { console.warn(`Aviso: ${error.message}.`); renderCarousels(); } }
        function applyStoreConfig() { const agendarOptionContainer = document.getElementById('agendar-option-container'); const orderOptionsGrid = document.getElementById('order-options'); const agendamentoHabilitado = lojaConfig.habilitarAgendamento !== false; if (agendamentoHabilitado) { agendarOptionContainer.style.display = 'block'; orderOptionsGrid.classList.remove('grid-cols-2'); orderOptionsGrid.classList.add('grid-cols-3'); } else { agendarOptionContainer.style.display = 'none'; orderOptionsGrid.classList.remove('grid-cols-3'); orderOptionsGrid.classList.add('grid-cols-2'); if (document.getElementById('option-schedule').checked) { document.getElementById('option-delivery').checked = true; handleOrderOptionChange(); } } }
        function renderCarousels() { const container = document.getElementById('product-carousels'); container.innerHTML = ''; const productsByCategory = allProducts.reduce((acc, product) => { (acc[product.categoria] = acc[product.categoria] || []).push(product); return acc; }, {}); if (Object.keys(productsByCategory).length === 0) { container.innerHTML = `<p class="text-center text-slate-500">Nenhum produto cadastrado no momento.</p>`; return; } for (const category in productsByCategory) { container.innerHTML += `<div class="category-section"><h2 class="text-2xl font-bold mb-5 text-slate-900">${category}</h2><div class="swiper-container"><div class="swiper-wrapper">${productsByCategory[category].map(product => `<div class="swiper-slide"><div class="bg-white rounded-lg shadow-md overflow-hidden group transition-all duration-300 hover:shadow-xl h-full flex flex-col"><div onclick="openModal(${product.id})" class="cursor-pointer"><img src="${product.fotos[0]}" onerror="this.src='https://placehold.co/500x500/e2e8f0/64748b?text=Imagem'" alt="${product.nome}" class="w-full h-48 sm:h-64 object-cover group-hover:scale-105 transition-transform duration-300"></div><div class="p-4 flex-grow flex flex-col justify-between"><div><h3 onclick="openModal(${product.id})" class="font-semibold text-lg truncate cursor-pointer text-slate-800 group-hover:text-sky-600 transition-colors">${product.nome}</h3></div><div class="mt-4 flex justify-between items-center"><p class="text-slate-900 font-bold text-xl">R$ ${product.preco.toFixed(2).replace('.', ',')}</p><button onclick="quickAddToCart(${product.id})" class="bg-sky-600 text-white rounded-full w-11 h-11 flex items-center justify-center shadow-lg hover:bg-sky-700 transition-all transform hover:scale-110 flex-shrink-0"><i class="fas fa-plus"></i></button></div></div></div></div>`).join('')}</div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div></div></div>`; } new Swiper('.swiper-container', { loop: false, slidesPerView: 1.4, spaceBetween: 16, navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }, breakpoints: { 640: { slidesPerView: 2.5 }, 768: { slidesPerView: 3.5 }, 1024: { slidesPerView: 4.5 } } }); }
        
        function openModal(productId) { 
            const product = allProducts.find(p => p.id === productId); if (!product) return; 
            const modal = document.getElementById('product-modal'); 
            const modalContent = document.getElementById('modal-content'); 
            const corHtml = lojaConfig.habilitarCor && product.cor ? `<p class="text-slate-500 text-sm mb-4">Cor: ${product.cor}</p>` : ''; 
            const tamanhosHtml = lojaConfig.habilitarTamanhos && product.tamanhos.length > 0 ? `<div class="mb-6"><label for="size-select" class="block text-sm font-medium text-slate-700 mb-1">Tamanho:</label><select id="size-select" class="w-full p-3 border border-slate-300 rounded-md bg-white">${product.tamanhos.map(size => `<option value="${size}">${size}</option>`).join('')}</select></div>` : '<input type="hidden" id="size-select" value="Único">'; 
            modalContent.innerHTML = `<div class="w-full md:w-1/2 p-4 flex-shrink-0"><img src="${product.fotos[0]}" onerror="this.src='https://placehold.co/500x500/e2e8f0/64748b?text=Imagem'" alt="${product.nome}" class="w-full h-64 md:h-full object-contain rounded-lg"></div><div class="w-full md:w-1/2 p-6 flex flex-col justify-center relative"><button onclick="closeModal()" class="absolute top-4 right-4 text-2xl text-slate-600 hover:text-black">&times;</button><h2 class="text-2xl md:text-3xl font-bold mb-2 text-slate-900">${product.nome}</h2><p class="text-xl md:text-2xl font-bold text-sky-600 mb-4">R$ ${product.preco.toFixed(2).replace('.', ',')}</p>${corHtml}<p class="text-slate-600 mb-6">${product.descricao}</p>${tamanhosHtml}<button onclick="addToCartFromModal(${product.id})" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold hover:bg-sky-700 transition-colors">Adicionar ao Carrinho</button></div>`; 
            modal.classList.remove('hidden'); 
            modal.classList.add('flex'); 
            setTimeout(() => modalContent.classList.remove('scale-95'), 10);
            toggleBodyScroll(true); // Trava o scroll
        }
        function closeModal() { 
            document.getElementById('product-modal').classList.add('hidden'); 
            document.getElementById('modal-content').classList.add('scale-95');
            toggleBodyScroll(false); // Destrava o scroll
        }

        function addToCartFromModal(productId) { addProductToCart(productId, document.getElementById('size-select').value); closeModal(); }
        function quickAddToCart(productId) { const product = allProducts.find(p => p.id === productId); if (!product) return; const size = (lojaConfig.habilitarTamanhos && product.tamanhos.length > 0) ? product.tamanhos[0] : 'Único'; addProductToCart(productId, size); }
        function addProductToCart(productId, size) { const product = allProducts.find(p => p.id === productId); const uniqueId = `${productId}-${size}`; const productInCart = cart.find(item => item.uniqueId === uniqueId); if (productInCart) productInCart.quantidade++; else cart.push({ ...product, tamanho: size, uniqueId, quantidade: 1 }); saveCart(); updateCartUI(); if (!primeiroItemAdicionado) { openCartConfirmationModal(); primeiroItemAdicionado = true; } else { showToast(); } }
        function showToast() { const toast = document.getElementById('toast-notification'); toast.classList.remove('translate-y-20', 'opacity-0'); setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 2000); }
        
        function openCartConfirmationModal() { const container = document.getElementById('bottom-sheet-container'); const content = document.getElementById('bottom-sheet-content'); container.classList.remove('hidden'); setTimeout(() => { container.classList.add('opacity-100'); content.classList.remove('translate-y-full'); }, 10); toggleBodyScroll(true); } // Trava o scroll
        function closeCartConfirmationModal() { const container = document.getElementById('bottom-sheet-container'); const content = document.getElementById('bottom-sheet-content'); container.classList.remove('opacity-100'); content.classList.add('translate-y-full'); setTimeout(() => { container.classList.add('hidden'); }, 300); toggleBodyScroll(false); } // Destrava o scroll
        
        function goToCart() { closeCartConfirmationModal(); setTimeout(() => { if (document.getElementById('cart-sidebar').classList.contains('translate-x-full')) { toggleCart(); } }, 300); }
        
        function toggleCart() {
            const cartSidebar = document.getElementById('cart-sidebar');
            const isOpening = cartSidebar.classList.contains('translate-x-full');
            cartSidebar.classList.toggle('translate-x-full');
            toggleBodyScroll(isOpening); // Trava se estiver abrindo, destrava se estiver fechando
        }

        function updateCartUI() { const cartItemsContainer = document.getElementById('cart-items'); const cartCount = document.getElementById('cart-count'); const cartTotal = document.getElementById('cart-total'); let totalEmCentavos = 0; cartItemsContainer.innerHTML = cart.length === 0 ? '<div class="text-center p-8"><i class="fas fa-shopping-cart text-4xl text-slate-300 mb-4"></i><p class="text-slate-500">Seu carrinho está vazio.</p></div>' : ''; cart.forEach(item => { totalEmCentavos += (item.preco * 100) * item.quantidade; const tamanhoHtml = lojaConfig.habilitarTamanhos && item.tamanho !== 'Único' ? `<p class="text-sm text-slate-600">Tamanho: ${item.tamanho}</p>` : ''; cartItemsContainer.innerHTML += `<div class="flex items-start justify-between mb-4 pb-4 border-b last:border-b-0"><img src="${item.fotos[0]}" onerror="this.src='https://placehold.co/150x150/e2e8f0/64748b?text=Img'" alt="${item.nome}" class="w-20 h-20 object-cover rounded-md"><div class="flex-grow mx-3"><p class="font-bold text-slate-800">${item.nome}</p>${tamanhoHtml}<p class="text-sm font-semibold text-slate-700">R$ ${item.preco.toFixed(2).replace('.', ',')}</p><div class="flex items-center space-x-3 mt-2"><button onclick="decreaseQuantity('${item.uniqueId}')" class="w-7 h-7 bg-slate-200 rounded-full font-bold flex items-center justify-center hover:bg-slate-300">-</button><span class="font-bold text-md">${item.quantidade}</span><button onclick="increaseQuantity('${item.uniqueId}')" class="w-7 h-7 bg-slate-200 rounded-full font-bold flex items-center justify-center hover:bg-slate-300">+</button></div></div><button onclick="removeFromCart('${item.uniqueId}')" class="text-red-500 hover:text-red-700 transition-colors p-2"><i class="fas fa-trash"></i></button></div>`; }); cartCount.textContent = cart.reduce((acc, item) => acc + item.quantidade, 0); cartTotal.textContent = `R$ ${(totalEmCentavos / 100).toFixed(2).replace('.', ',')}`; validarFormularioCheckout(); }
        const increaseQuantity = (id) => changeQuantity(id, 1); const decreaseQuantity = (id) => changeQuantity(id, -1);
        function changeQuantity(uniqueId, amount) { const item = cart.find(item => item.uniqueId === uniqueId); if (item) { item.quantidade += amount; if (item.quantidade <= 0) removeFromCart(uniqueId); else { saveCart(); updateCartUI(); } } }
        const removeFromCart = (id) => { cart = cart.filter(item => item.uniqueId !== id); saveCart(); updateCartUI(); };
        function saveCart() { sessionStorage.setItem('lojaCarrinho', JSON.stringify(cart)); }
        function loadCart() { const savedCart = sessionStorage.getItem('lojaCarrinho'); if (savedCart) cart = JSON.parse(savedCart); }
        function syncCartWithProducts() { if (cart.length === 0 || allProducts.length === 0) { updateCartUI(); return; } let cartFoiModificado = false; const carrinhoAtualizado = cart.map(itemNoCarrinho => { const produtoNaLoja = allProducts.find(p => p.id === itemNoCarrinho.id); if (!produtoNaLoja) { cartFoiModificado = true; return null; } const dadosParaAtualizar = { preco: produtoNaLoja.preco, nome: produtoNaLoja.nome, fotos: produtoNaLoja.fotos }; Object.assign(itemNoCarrinho, dadosParaAtualizar); if (itemNoCarrinho.preco !== produtoNaLoja.preco) cartFoiModificado = true; return itemNoCarrinho; }).filter(Boolean); cart = carrinhoAtualizado; if (cartFoiModificado) { saveCart(); showToast('Seu carrinho foi atualizado.'); } updateCartUI(); }
        function handleOrderOptionChange() { const selectedOption = document.querySelector('input[name="order-option"]:checked').value; const addressField = document.getElementById('address-field'); const scheduleFields = document.getElementById('schedule-fields'); const addressInput = document.getElementById('customer-address'); const scheduleInputs = scheduleFields.querySelectorAll('input'); addressInput.required = (selectedOption === 'Delivery'); addressField.style.display = (selectedOption === 'Delivery') ? 'block' : 'none'; scheduleInputs.forEach(input => input.required = (selectedOption === 'Agendar Mesa')); scheduleFields.style.display = (selectedOption === 'Agendar Mesa') ? 'block' : 'none'; validarFormularioCheckout(); }
        function validarFormularioCheckout() { const form = document.getElementById('checkout-form'); const inputs = form.querySelectorAll('input[required], select[required]'); const finalizeButton = document.getElementById('finalize-button'); let isFormValid = true; inputs.forEach(input => { const value = input.value.trim(); if (!value || (input.tagName === 'SELECT' && input.selectedIndex === 0)) { isFormValid = false; input.classList.add('invalid-field'); } else { input.classList.remove('invalid-field'); } }); const isAgendamentoValido = document.querySelector('input[name="order-option"]:checked').value === 'Agendar Mesa'; finalizeButton.disabled = !(isFormValid && (cart.length > 0 || isAgendamentoValido)); }
        function generateOrderNumber() { const timestamp = Date.now().toString().slice(-5); const randomPart = Math.random().toString(36).substr(2, 4).toUpperCase(); return `PEDIDO-${timestamp}-${randomPart}`; }
        function finalizeOrder() { if (document.getElementById('finalize-button').disabled) { validarFormularioCheckout(); alert("Por favor, preencha todos os campos destacados em vermelho."); return; } const orderNumber = generateOrderNumber(); const selectedOption = document.querySelector('input[name="order-option"]:checked').value; const customerName = document.getElementById('customer-name').value; const customerContact = document.getElementById('customer-contact').value; const customerPayment = document.getElementById('customer-payment').value; const customerObservation = document.getElementById('customer-observation').value; let message = `*Novo Pedido: #${orderNumber}*\n\n*Tipo de Atendimento:* ${selectedOption}\n\n`; if (selectedOption === 'Delivery') { const customerAddress = document.getElementById('customer-address').value; message += `*Cliente:* ${customerName}\n*Endereço:* ${customerAddress}\n*Contato:* ${customerContact}\n`; } else if (selectedOption === 'Agendar Mesa') { const scheduleDate = document.getElementById('schedule-date').value; const scheduleTime = document.getElementById('schedule-time').value; const schedulePeople = document.getElementById('schedule-people').value; const [year, month, day] = scheduleDate.split('-'); const formattedDate = `${day}/${month}/${year}`; message += `*DADOS DA RESERVA*\n*Nome:* ${customerName}\n*Contato:* ${customerContact}\n*Data:* ${formattedDate}\n*Hora:* ${scheduleTime}\n*Nº de Pessoas:* ${schedulePeople}\n`; } else { message += `*Cliente:* ${customerName}\n*Contato:* ${customerContact}\n`; } message += `*Forma de Pagamento:* ${customerPayment}\n`; if (customerObservation.trim()) message += `*Observação:* ${customerObservation.trim()}\n`; if (cart.length > 0) { message += "\n*--- ITENS DO PEDIDO ---*\n"; const totalEmCentavos = cart.reduce((acc, item) => acc + (item.preco * 100) * item.quantidade, 0); cart.forEach(item => { const tamanhoInfo = lojaConfig.habilitarTamanhos && item.tamanho !== 'Único' ? `*Tamanho:* ${item.tamanho}\n` : ''; message += `\n*Produto:* ${item.nome} (*Cód: ${item.codigo}*)\n${tamanhoInfo}*Qtd:* ${item.quantidade}\n*Preço Un.:* R$ ${item.preco.toFixed(2).replace('.', ',')}\n`; }); message += `\n*-------------------------*\n*TOTAL DO PEDIDO: R$ ${(totalEmCentavos / 100).toFixed(2).replace('.', ',')}*\n`; } message += `\nAguardando confirmação. Obrigado!`; 
            window.location.href = `https://wa.me/${empresaWhatsappNumber}?text=${encodeURIComponent(message)}`;
        }
    </script>
</body>
</html>

